<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control Financiero Personal</title>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#f4f6f8;
  padding:20px
}
.container{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.15)
}
h2{margin-top:0}
form{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:10px;
  margin-bottom:20px
}
input,button{
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc
}
button{
  background:#4361ee;
  color:#fff;
  border:none;
  font-weight:bold;
  cursor:pointer
}
button.del{background:#e71d36}
button.edit{background:#ff9f1c;color:#000}
table{
  width:100%;
  border-collapse:collapse
}
th,td{
  padding:10px;
  border-bottom:1px solid #ddd;
  text-align:left
}
th{background:#f1f3f5}
#msg{opacity:.8;font-size:.9em}
</style>
</head>

<body>

<div class="container">
  <h2>üí∞ Control Financiero</h2>
  <p id="msg">Cargando datos‚Ä¶</p>

  <!-- ================= GASTOS ================= -->
  <h3>Gastos</h3>
  <form onsubmit="add(event,'addGasto')">
    <input type="date" name="fecha" required>
    <input name="descripcion" placeholder="Descripci√≥n" required>
    <input name="categoria" placeholder="Categor√≠a">
    <input type="number" name="monto" placeholder="Monto" required>
    <input name="pago" placeholder="Pago">
    <button>Guardar</button>
  </form>

  <table id="tblGastos"></table>
</div>

<script>
const URL_API = 'https://script.google.com/macros/s/AKfycbw2GtG5vsvvpg2dfNMnBFmiEOco6oiv7wOwhuQD3iJmxWh73PwrhU7W_OeqSZXWr7Rf/exec';
let DB = { gastos: [] };

// ================= LOAD =================
async function load(){
  msg('‚åõ Cargando‚Ä¶');
  DB = await fetch(URL_API).then(r=>r.json());
  renderGastos();
  msg('‚úÖ Sincronizado');
}

// ================= RENDER =================
function renderGastos(){
  const t = document.getElementById('tblGastos');
  t.innerHTML = `
    <tr>
      <th>Fecha</th>
      <th>Descripci√≥n</th>
      <th>Monto</th>
      <th>Acciones</th>
    </tr>
    ${DB.gastos.map(g=>`
      <tr>
        <td>${g.fecha}</td>
        <td>${g.descripcion}</td>
        <td>$${Number(g.monto).toLocaleString()}</td>
        <td>
          <button class="edit" onclick="editGasto(${g.rowId},${g.monto})">‚úèÔ∏è</button>
          <button class="del" onclick="del('deleteGasto',${g.rowId})">‚ùå</button>
        </td>
      </tr>
    `).join('')}
  `;
}

// ================= ADD =================
async function add(e,action){
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target));
  data.action = action;

  await fetch(URL_API,{
    method:'POST',
    body:JSON.stringify(data)
  });

  e.target.reset();
  load();
}

// ================= DELETE =================
async function del(action,index){
  if(!confirm('¬øEliminar este registro?')) return;
  await fetch(URL_API,{
    method:'POST',
    body:JSON.stringify({action,index})
  });
  load();
}

// ================= EDIT =================
async function editGasto(rowId,monto){
  const nuevo = prompt('Nuevo monto:',monto);
  if(!nuevo) return;

  const g = DB.gastos.find(x=>x.rowId===rowId);
  g.monto = nuevo;
  g.action = 'updateGasto';
  g.index = rowId;

  await fetch(URL_API,{
    method:'POST',
    body:JSON.stringify(g)
  });
  load();
}

// ================= UTILS =================
function msg(t){
  document.getElementById('msg').innerText = t;
}

load();
</script>

</body>
</html>
